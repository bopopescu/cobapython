import threading
import urllib.request as urllib2
import datetime
import time

hasil_test = []

def proxy_check(id,ip,port):
    address = str(ip) + ":" + str(port)
    print(address,threading.currentThread().getName(), 'Starting')
    now = datetime.datetime.now()
    started = now.strftime("%Y-%m-%d %H:%M:%S")
    try:
        proxy_handler = urllib2.ProxyHandler({'http': address})
        opener = urllib2.build_opener(proxy_handler)
        opener.addheaders = [('User-agent', 'Mozilla/5.0')]
        urllib2.install_opener(opener)
        req = urllib2.Request("http://103.41.204.195/ping.php")
        sock = urllib2.urlopen(req, timeout=60)
        rs = sock.read(1000)
        if rs is None:
            proxy_result = "No"
        else:
            proxy_result = "Yes"
        now = datetime.datetime.now()
        finished = now.strftime("%Y-%m-%d %H:%M:%S")
    except:
        proxy_result = "No"
        now = datetime.datetime.now()
        finished = now.strftime("%Y-%m-%d %H:%M:%S")

    isi_test = (ip,port,started,finished,proxy_result)
    hasil_test.append(isi_test)
    print(threading.currentThread().getName(), 'Exiting')

# list_ip = [(1,'194.228.129.189','32753'),(2,'185.188.218.10','60928'),(3,'81.28.164.55','52658'),(4,'196.52.58.235','80')]
list_ip = [(1,'159.203.166.41','8080'),(2,'139.59.53.107','3128'),(3,'196.52.80.75','80'),(4,'174.138.54.49','8080')]
for data in list_ip:
    id = data[0]
    ip = data[1]
    port = data[2]
    t = threading.Thread(target=proxy_check, args=(id,ip,port))
    t.start()
t.join()

time.sleep(65)
print(hasil_test)
