# import socks
# import threading
# import urllib.request as urllib2
#
# def proxy_check(ip,port,timeout):
#     address = str(ip) + ":" + str(port)
#     print(address,threading.currentThread().getName(), 'Starting')
#     try:
#         proxy_handler = urllib2.ProxyHandler({'http': address})
#         opener = urllib2.build_opener(proxy_handler)
#         opener.addheaders = [('User-agent', 'Mozilla/5.0')]
#         urllib2.install_opener(opener)
#         req = urllib2.Request("https://www.google.com/")
#         # http://103.41.204.195/ping.php
#         sock = urllib2.urlopen(req, timeout=timeout)
#         rs = sock.read(1000)
#         if rs is None:
#             proxy_result = "No"
#         else:
#             proxy_result = "Yes"
#     except:
#         proxy_result = "No"
#
#     isi_test = (ip,port,started,finished,proxy_result)
#     hasil_test.append(isi_test)
#     print(threading.currentThread().getName(), 'Exiting')
#
# def sock_proxy(ip,port):
#     s = socks.socksocket()
#     s.set_proxy(socks.SOCKS4,ip)
#     s.set_proxy(socks.SOCKS5,ip,int(port))
#     s.set_proxy(socks.HTTP,ip,port)
#
#     s.connect(("https://www.google.com/",80))
#     s.sendall("GET / HTTP/1.1 ...")
#     s.send(str.encode("GET / HTTP/1.1\r\n\r\n"))
#     print(s.recv(4096))
#
# list_ip = [(1, '159.203.166.41', '8080'), (2, '139.59.53.107', '3128'), (3, '196.52.80.75', '80'),
#            (4, '174.138.54.49', '8080'), (5, '194.228.129.189', '32753'), (6, '185.188.218.10', '60928'),
#            (7, '81.28.164.55', '52658'), (8, '196.52.58.235', '80')]
#
# for data in list_ip:
#     # id = data[0]
#     ip = data[1]
#     port = data[2]
#     sock_proxy(ip,port)


# import urllib.request as urllib2
# import socks
# from sockshandler import SocksiPyHandler
#
# opener = urllib2.build_opener(SocksiPyHandler(socks.SOCKS5, "81.28.164.55", 52658))
# rs = opener.open("https://www.google.com/") # All requests made by the opener will pass through the SOCKS proxy
# print(rs)

# import urllib.request as urllib2
# import socket
# import socks
#
# socks.set_default_proxy(socks.SOCKS4, "81.28.164.55",52658)
# socket.socket = socks.socksocket
# urllib2.urlopen("https://www.google.com/", timeout=10) # All requests will pass through the SOCKS proxy

# import requests
#
# url = "https://www.google.com"
# # proxy_1 = "81.28.164.55:52658"
# rq = requests.get(url, proxies={"http": "socks4://180.249.114.183:4145", "https": "socks4://180.249.114.183:4145"})
# print(rq)

# def proxy_info_from_url(url, method='http'):
#     """
#     Construct a ProxyInfo from a URL (such as http_proxy env var)
#     """
#     url = urlparse.urlparse(url)
#     username = None
#     password = None
#     port = None
#     if '@' in url[1]:
#         ident, host_port = url[1].split('@', 1)
#         if ':' in ident:
#             username, password = ident.split(':', 1)
#         else:
#             password = ident
#     else:
#         host_port = url[1]
#     if ':' in host_port:
#         host, port = host_port.split(':', 1)
#     else:
#         host = host_port
#
#     if port:
#         port = int(port)
#     else:
#         port = dict(https=443, http=80)[method]
#
#     proxy_type = 3 # socks.PROXY_TYPE_HTTP
#     return ProxyInfo(
#         proxy_type = proxy_type,
#         proxy_host = host,
#         proxy_port = port,
#         proxy_user = username or None,
#         proxy_pass = password or None,
#     )

import socks
import urllib.request
import socket

# s = socks.socksocket()
# # s.set_proxy(socks.SOCKS5,"")
# s.set_proxy(socks.SOCKS4,"ruangguru.com",443)
# s.connect(("https://www.google.com",80))
# s.send(str.encode("GET / HTTP/1.1\r\n\r\n"))
# proxies = ['118.96.149.97','114.6.176.179','43.248.24.235','210.57.216.109','150.107.246.141','36.67.184.179','122.200.144.25','103.247.13.34'] # SOCKS 4
# proxies = ['138.197.157.60','138.197.157.32','138.197.157.45','138.197.145.103','138.197.157.44'] # SOCKS 5
proxies = ['ruangguru.com:443','audisi.ruangguru.com:443','uji.ruangguru.com:443','ruangguruuji.imgix.net:443',
             'tracker.ruangguru.com:443','bimbel.ruangguru.com:443','marketing.ruangguru.com:443','mitra.ruangguru.com:443',
             'blog.ruangguru.com:443','event.ruangguru.com:443']

def proxy_manual(ip):
    print("3")
    proxy_handler = urllib.request.ProxyHandler({'http': ip})
    opener = urllib.request.build_opener(proxy_handler)
    opener.addheaders = [('User-agent', 'Mozilla/5.0')]
    urllib.request.install_opener(opener)
    req = urllib.request.Request("http://www.google.com/")
    # http://103.41.204.195/ping.php
    sock = urllib.request.urlopen(req, timeout=20)
    rs = sock.read(1000)
    if rs is None:
        print("No")
        req = urllib.request.Request("https://www.google.com/")
        # http://103.41.204.195/ping.php
        sock = urllib.request.urlopen(req, timeout=20)
        rs = sock.read(1000)
        if rs is None:
            print("No")
        else:
            print("Yes")
    else:
        print("Yes")

for ips in proxies:
    proxys = ips.split(":",2)
    ip = proxys[0]
    if len(proxys) == 2:
        port = proxys[1]

    try:
        print("1")
        socks.set_default_proxy(socks.SOCKS4, ip, 4145)
        # socks.set_default_proxy(socks.SOCKS5,ip)
        # socks.set_default_proxy(socks.PROXY_TYPE_HTTP,host,int(port))
        socket.socket = socks.socksocket
        res = urllib.request.urlopen("http://www.google.com/", timeout=1)
        rs = res.read(1000)
        if rs is None:
            print("No")
            res2 = urllib.request.urlopen("https://www.google.com/", timeout=1)
            rs2 = res2.read(1000)
            if rs2 is None:
                print("No")
            else:
                print(rs2)
                print("Yes")
        else:
            print(rs)
            print("Yes")
    except (urllib.error.URLError,socket.timeout,socks.GeneralProxyError):
        print("2")
        # socks.set_default_proxy(socks.SOCKS4, ip, 4145)
        socks.set_default_proxy(socks.SOCKS5,ip)
        # socks.set_default_proxy(socks.PROXY_TYPE_HTTP,host,int(port))
        socket.socket = socks.socksocket
        res = urllib.request.urlopen("http://www.google.com/", timeout=1)
        rs = res.read(1000)
        if rs is None:
            print("No")
            res2 = urllib.request.urlopen("https://www.google.com/", timeout=1)
            rs2 = res2.read(1000)
            if rs2 is None:
                print("No")
            else:
                print(rs2)
                print("Yes")
        else:
            print(rs)
            print("Yes")
    except (urllib.error.URLError,socket.timeout,socks.GeneralProxyError):
        proxy_manual(ips)
    finally:
        print("Finish Process")

    exit()